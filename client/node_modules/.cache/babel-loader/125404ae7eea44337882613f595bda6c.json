{"ast":null,"code":"\"use strict\";\n\nvar _defineProperty = require(\"/Users/albertshay/Desktop/silkroad/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/defineProperty\");\n\nvar _objectSpread = require(\"/Users/albertshay/Desktop/silkroad/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/objectSpread2\");\n\nvar _classCallCheck = require(\"/Users/albertshay/Desktop/silkroad/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/classCallCheck\");\n\nvar _createClass = require(\"/Users/albertshay/Desktop/silkroad/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/createClass\");\n\nvar _inherits = require(\"/Users/albertshay/Desktop/silkroad/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/inherits\");\n\nvar _createSuper = require(\"/Users/albertshay/Desktop/silkroad/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/createSuper\");\n\nvar _require = require('preact'),\n    h = _require.h,\n    Component = _require.Component;\n\nvar classNames = require('classnames');\n\nvar _require2 = require('nanoid'),\n    nanoid = _require2.nanoid;\n\nvar getFileTypeIcon = require('../../utils/getFileTypeIcon');\n\nvar ignoreEvent = require('../../utils/ignoreEvent.js');\n\nvar FilePreview = require('../FilePreview');\n\nvar FileCard = /*#__PURE__*/function (_Component) {\n  _inherits(FileCard, _Component);\n\n  var _super = _createSuper(FileCard);\n\n  function FileCard(props) {\n    var _this;\n\n    _classCallCheck(this, FileCard);\n\n    _this = _super.call(this, props);\n    _this.form = document.createElement('form');\n\n    _this.updateMeta = function (newVal, name) {\n      _this.setState(function (_ref) {\n        var formState = _ref.formState;\n        return {\n          formState: _objectSpread(_objectSpread({}, formState), {}, _defineProperty({}, name, newVal))\n        };\n      });\n    };\n\n    _this.handleSave = function (e) {\n      e.preventDefault();\n      var fileID = _this.props.fileCardFor;\n\n      _this.props.saveFileCard(_this.state.formState, fileID);\n    };\n\n    _this.handleCancel = function () {\n      _this.props.toggleFileCard(false);\n    };\n\n    _this.saveOnEnter = function (ev) {\n      if (ev.keyCode === 13) {\n        ev.stopPropagation();\n        ev.preventDefault();\n        var file = _this.props.files[_this.props.fileCardFor];\n\n        _this.props.saveFileCard(_this.state.formState, file.id);\n      }\n    };\n\n    _this.renderMetaFields = function () {\n      var metaFields = _this.getMetaFields() || [];\n      var fieldCSSClasses = {\n        text: 'uppy-u-reset uppy-c-textInput uppy-Dashboard-FileCard-input'\n      };\n      return metaFields.map(function (field) {\n        var id = \"uppy-Dashboard-FileCard-input-\".concat(field.id);\n\n        var required = _this.props.requiredMetaFields.includes(field.id);\n\n        return h(\"fieldset\", {\n          key: field.id,\n          className: \"uppy-Dashboard-FileCard-fieldset\"\n        }, h(\"label\", {\n          className: \"uppy-Dashboard-FileCard-label\",\n          htmlFor: id\n        }, field.name), field.render !== undefined ? field.render({\n          value: _this.state.formState[field.id],\n          onChange: function onChange(newVal) {\n            return _this.updateMeta(newVal, field.id);\n          },\n          fieldCSSClasses: fieldCSSClasses,\n          required: required,\n          form: _this.form.id\n        }, h) : h(\"input\", {\n          className: fieldCSSClasses.text,\n          id: id,\n          form: _this.form.id,\n          type: field.type || 'text',\n          required: required,\n          value: _this.state.formState[field.id],\n          placeholder: field.placeholder // If `form` attribute is not supported, we need to capture pressing Enter to avoid bubbling in case Uppy is\n          // embedded inside a <form>.\n          ,\n          onKeyUp: 'form' in HTMLInputElement.prototype ? undefined : _this.saveOnEnter,\n          onKeyDown: 'form' in HTMLInputElement.prototype ? undefined : _this.saveOnEnter,\n          onKeyPress: 'form' in HTMLInputElement.prototype ? undefined : _this.saveOnEnter,\n          onInput: function onInput(ev) {\n            return _this.updateMeta(ev.target.value, field.id);\n          },\n          \"data-uppy-super-focusable\": true\n        }));\n      });\n    };\n\n    var _file = _this.props.files[_this.props.fileCardFor];\n\n    var _metaFields = _this.getMetaFields() || [];\n\n    var storedMetaData = {};\n\n    _metaFields.forEach(function (field) {\n      storedMetaData[field.id] = _file.meta[field.id] || '';\n    });\n\n    _this.state = {\n      formState: storedMetaData\n    };\n    _this.form.id = nanoid();\n    return _this;\n  } // TODO(aduh95): move this to `UNSAFE_componentWillMount` when updating to Preact X+.\n\n\n  _createClass(FileCard, [{\n    key: \"componentWillMount\",\n    value: function componentWillMount() {\n      // eslint-disable-line react/no-deprecated\n      this.form.addEventListener('submit', this.handleSave);\n      document.body.appendChild(this.form);\n    }\n  }, {\n    key: \"componentWillUnmount\",\n    value: function componentWillUnmount() {\n      this.form.removeEventListener('submit', this.handleSave);\n      document.body.removeChild(this.form);\n    }\n  }, {\n    key: \"getMetaFields\",\n    value: function getMetaFields() {\n      return typeof this.props.metaFields === 'function' ? this.props.metaFields(this.props.files[this.props.fileCardFor]) : this.props.metaFields;\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var _this2 = this;\n\n      var file = this.props.files[this.props.fileCardFor];\n      var showEditButton = this.props.canEditFile(file);\n      return h(\"div\", {\n        className: classNames('uppy-Dashboard-FileCard', this.props.className),\n        \"data-uppy-panelType\": \"FileCard\",\n        onDragOver: ignoreEvent,\n        onDragLeave: ignoreEvent,\n        onDrop: ignoreEvent,\n        onPaste: ignoreEvent\n      }, h(\"div\", {\n        className: \"uppy-DashboardContent-bar\"\n      }, h(\"div\", {\n        className: \"uppy-DashboardContent-title\",\n        role: \"heading\",\n        \"aria-level\": \"1\"\n      }, this.props.i18nArray('editing', {\n        file: h(\"span\", {\n          className: \"uppy-DashboardContent-titleFile\"\n        }, file.meta ? file.meta.name : file.name)\n      })), h(\"button\", {\n        className: \"uppy-DashboardContent-back\",\n        type: \"button\",\n        form: this.form.id,\n        title: this.props.i18n('finishEditingFile'),\n        onClick: this.handleCancel\n      }, this.props.i18n('cancel'))), h(\"div\", {\n        className: \"uppy-Dashboard-FileCard-inner\"\n      }, h(\"div\", {\n        className: \"uppy-Dashboard-FileCard-preview\",\n        style: {\n          backgroundColor: getFileTypeIcon(file.type).color\n        }\n      }, h(FilePreview, {\n        file: file\n      }), showEditButton && h(\"button\", {\n        type: \"button\",\n        className: \"uppy-u-reset uppy-c-btn uppy-Dashboard-FileCard-edit\",\n        onClick: function onClick() {\n          return _this2.props.openFileEditor(file);\n        },\n        form: this.form.id\n      }, this.props.i18n('editFile'))), h(\"div\", {\n        className: \"uppy-Dashboard-FileCard-info\"\n      }, this.renderMetaFields()), h(\"div\", {\n        className: \"uppy-Dashboard-FileCard-actions\"\n      }, h(\"button\", {\n        className: \"uppy-u-reset uppy-c-btn uppy-c-btn-primary uppy-Dashboard-FileCard-actionsBtn\" // If `form` attribute is supported, we want a submit button to trigger the form validation.\n        // Otherwise, fallback to a classic button with a onClick event handler.\n        ,\n        type: 'form' in HTMLButtonElement.prototype ? 'submit' : 'button',\n        onClick: 'form' in HTMLButtonElement.prototype ? undefined : this.handleSave,\n        form: this.form.id\n      }, this.props.i18n('saveChanges')), h(\"button\", {\n        className: \"uppy-u-reset uppy-c-btn uppy-c-btn-link uppy-Dashboard-FileCard-actionsBtn\",\n        type: \"button\",\n        onClick: this.handleCancel,\n        form: this.form.id\n      }, this.props.i18n('cancel')))));\n    }\n  }]);\n\n  return FileCard;\n}(Component);\n\nmodule.exports = FileCard;","map":{"version":3,"sources":["/Users/albertshay/Desktop/silkroad/client/node_modules/@uppy/dashboard/lib/components/FileCard/index.js"],"names":["require","h","Component","classNames","nanoid","getFileTypeIcon","ignoreEvent","FilePreview","FileCard","props","form","document","createElement","updateMeta","newVal","name","setState","formState","handleSave","e","preventDefault","fileID","fileCardFor","saveFileCard","state","handleCancel","toggleFileCard","saveOnEnter","ev","keyCode","stopPropagation","file","files","id","renderMetaFields","metaFields","getMetaFields","fieldCSSClasses","text","map","field","required","requiredMetaFields","includes","key","className","htmlFor","render","undefined","value","onChange","type","placeholder","onKeyUp","HTMLInputElement","prototype","onKeyDown","onKeyPress","onInput","target","_file","_metaFields","storedMetaData","forEach","meta","addEventListener","body","appendChild","removeEventListener","removeChild","showEditButton","canEditFile","onDragOver","onDragLeave","onDrop","onPaste","role","i18nArray","title","i18n","onClick","style","backgroundColor","color","openFileEditor","HTMLButtonElement","module","exports"],"mappings":"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","sourcesContent":["\"use strict\";\n\nconst {\n  h,\n  Component\n} = require('preact');\n\nconst classNames = require('classnames');\n\nconst {\n  nanoid\n} = require('nanoid');\n\nconst getFileTypeIcon = require('../../utils/getFileTypeIcon');\n\nconst ignoreEvent = require('../../utils/ignoreEvent.js');\n\nconst FilePreview = require('../FilePreview');\n\nclass FileCard extends Component {\n  constructor(props) {\n    super(props);\n    this.form = document.createElement('form');\n\n    this.updateMeta = (newVal, name) => {\n      this.setState(({\n        formState\n      }) => ({\n        formState: { ...formState,\n          [name]: newVal\n        }\n      }));\n    };\n\n    this.handleSave = e => {\n      e.preventDefault();\n      const fileID = this.props.fileCardFor;\n      this.props.saveFileCard(this.state.formState, fileID);\n    };\n\n    this.handleCancel = () => {\n      this.props.toggleFileCard(false);\n    };\n\n    this.saveOnEnter = ev => {\n      if (ev.keyCode === 13) {\n        ev.stopPropagation();\n        ev.preventDefault();\n        const file = this.props.files[this.props.fileCardFor];\n        this.props.saveFileCard(this.state.formState, file.id);\n      }\n    };\n\n    this.renderMetaFields = () => {\n      const metaFields = this.getMetaFields() || [];\n      const fieldCSSClasses = {\n        text: 'uppy-u-reset uppy-c-textInput uppy-Dashboard-FileCard-input'\n      };\n      return metaFields.map(field => {\n        const id = `uppy-Dashboard-FileCard-input-${field.id}`;\n        const required = this.props.requiredMetaFields.includes(field.id);\n        return h(\"fieldset\", {\n          key: field.id,\n          className: \"uppy-Dashboard-FileCard-fieldset\"\n        }, h(\"label\", {\n          className: \"uppy-Dashboard-FileCard-label\",\n          htmlFor: id\n        }, field.name), field.render !== undefined ? field.render({\n          value: this.state.formState[field.id],\n          onChange: newVal => this.updateMeta(newVal, field.id),\n          fieldCSSClasses,\n          required,\n          form: this.form.id\n        }, h) : h(\"input\", {\n          className: fieldCSSClasses.text,\n          id: id,\n          form: this.form.id,\n          type: field.type || 'text',\n          required: required,\n          value: this.state.formState[field.id],\n          placeholder: field.placeholder // If `form` attribute is not supported, we need to capture pressing Enter to avoid bubbling in case Uppy is\n          // embedded inside a <form>.\n          ,\n          onKeyUp: 'form' in HTMLInputElement.prototype ? undefined : this.saveOnEnter,\n          onKeyDown: 'form' in HTMLInputElement.prototype ? undefined : this.saveOnEnter,\n          onKeyPress: 'form' in HTMLInputElement.prototype ? undefined : this.saveOnEnter,\n          onInput: ev => this.updateMeta(ev.target.value, field.id),\n          \"data-uppy-super-focusable\": true\n        }));\n      });\n    };\n\n    const _file = this.props.files[this.props.fileCardFor];\n\n    const _metaFields = this.getMetaFields() || [];\n\n    const storedMetaData = {};\n\n    _metaFields.forEach(field => {\n      storedMetaData[field.id] = _file.meta[field.id] || '';\n    });\n\n    this.state = {\n      formState: storedMetaData\n    };\n    this.form.id = nanoid();\n  } // TODO(aduh95): move this to `UNSAFE_componentWillMount` when updating to Preact X+.\n\n\n  componentWillMount() {\n    // eslint-disable-line react/no-deprecated\n    this.form.addEventListener('submit', this.handleSave);\n    document.body.appendChild(this.form);\n  }\n\n  componentWillUnmount() {\n    this.form.removeEventListener('submit', this.handleSave);\n    document.body.removeChild(this.form);\n  }\n\n  getMetaFields() {\n    return typeof this.props.metaFields === 'function' ? this.props.metaFields(this.props.files[this.props.fileCardFor]) : this.props.metaFields;\n  }\n\n  render() {\n    const file = this.props.files[this.props.fileCardFor];\n    const showEditButton = this.props.canEditFile(file);\n    return h(\"div\", {\n      className: classNames('uppy-Dashboard-FileCard', this.props.className),\n      \"data-uppy-panelType\": \"FileCard\",\n      onDragOver: ignoreEvent,\n      onDragLeave: ignoreEvent,\n      onDrop: ignoreEvent,\n      onPaste: ignoreEvent\n    }, h(\"div\", {\n      className: \"uppy-DashboardContent-bar\"\n    }, h(\"div\", {\n      className: \"uppy-DashboardContent-title\",\n      role: \"heading\",\n      \"aria-level\": \"1\"\n    }, this.props.i18nArray('editing', {\n      file: h(\"span\", {\n        className: \"uppy-DashboardContent-titleFile\"\n      }, file.meta ? file.meta.name : file.name)\n    })), h(\"button\", {\n      className: \"uppy-DashboardContent-back\",\n      type: \"button\",\n      form: this.form.id,\n      title: this.props.i18n('finishEditingFile'),\n      onClick: this.handleCancel\n    }, this.props.i18n('cancel'))), h(\"div\", {\n      className: \"uppy-Dashboard-FileCard-inner\"\n    }, h(\"div\", {\n      className: \"uppy-Dashboard-FileCard-preview\",\n      style: {\n        backgroundColor: getFileTypeIcon(file.type).color\n      }\n    }, h(FilePreview, {\n      file: file\n    }), showEditButton && h(\"button\", {\n      type: \"button\",\n      className: \"uppy-u-reset uppy-c-btn uppy-Dashboard-FileCard-edit\",\n      onClick: () => this.props.openFileEditor(file),\n      form: this.form.id\n    }, this.props.i18n('editFile'))), h(\"div\", {\n      className: \"uppy-Dashboard-FileCard-info\"\n    }, this.renderMetaFields()), h(\"div\", {\n      className: \"uppy-Dashboard-FileCard-actions\"\n    }, h(\"button\", {\n      className: \"uppy-u-reset uppy-c-btn uppy-c-btn-primary uppy-Dashboard-FileCard-actionsBtn\" // If `form` attribute is supported, we want a submit button to trigger the form validation.\n      // Otherwise, fallback to a classic button with a onClick event handler.\n      ,\n      type: 'form' in HTMLButtonElement.prototype ? 'submit' : 'button',\n      onClick: 'form' in HTMLButtonElement.prototype ? undefined : this.handleSave,\n      form: this.form.id\n    }, this.props.i18n('saveChanges')), h(\"button\", {\n      className: \"uppy-u-reset uppy-c-btn uppy-c-btn-link uppy-Dashboard-FileCard-actionsBtn\",\n      type: \"button\",\n      onClick: this.handleCancel,\n      form: this.form.id\n    }, this.props.i18n('cancel')))));\n  }\n\n}\n\nmodule.exports = FileCard;"]},"metadata":{},"sourceType":"script"}